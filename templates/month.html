{% extends "base.html" %}

{% block title %}Monthly Expenses - MoneyTrack{% endblock %}

{% block page_title %}Monthly Expenses{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb-item">
    <i class="fas fa-home"></i>
    <span>Dashboard</span>
</div>
<span class="breadcrumb-separator">/</span>
<div class="breadcrumb-item">
    <i class="fas fa-calendar-alt"></i>
    <span>Monthly</span>
</div>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3">
    <!-- Date-based Breakdown -->
    <div class="lg:col-span-1">
        <div class="card mb-5" data-aos="fade-up">
            <div class="card-header">
                <h3 class="card-title">Monthly Timeline</h3>
                <p class="card-subtitle">Expenses by date</p>
            </div>
            <div class="card-body">
                <div style="margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--gray-200);">
                    <div style="display: flex; justify-content: space-between; font-weight: 600; color: var(--text-primary);">
                        <span>Date</span>
                        <span>Amount</span>
                    </div>
                </div>
                
                {% if texpense %}
                    {% for row in texpense %}
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; 
                                border-bottom: 1px solid var(--gray-200);">
                        <span style="color: var(--text-primary);">{{ row[0] }}</span>
                        <span style="font-weight: 600; color: var(--danger-color);">GH${{ row[1] }}</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <div style="text-align: center; padding: 2rem 0;">
                        <i class="fas fa-calendar-alt" style="font-size: 2rem; color: var(--gray-300); margin-bottom: 1rem;"></i>
                        <p style="color: var(--text-secondary);">No expenses recorded this month</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Category Breakdown -->
    <div class="lg:col-span-2">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <!-- Category List -->
            <div class="card" data-aos="fade-up" data-aos-delay="200">
                <div class="card-header">
                    <h3 class="card-title">Category Breakdown</h3>
                    <p class="card-subtitle">Monthly expenses by category</p>
                </div>
                <div class="card-body">
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        {% if t_food %}
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem; 
                                    background-color: var(--bg-secondary); border-radius: var(--radius-lg);">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; 
                                            background-color: var(--primary-color); display: flex; 
                                            align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <span style="font-weight: 500;">Food</span>
                            </div>
                            <span style="font-weight: 600; color: var(--text-primary);" id="tfood">GH${{ t_food }}</span>
                        </div>
                        {% endif %}
                        
                        {% if t_entertainment %}
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem; 
                                    background-color: var(--bg-secondary); border-radius: var(--radius-lg);">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; 
                                            background-color: var(--success-color); display: flex; 
                                            align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-film"></i>
                                </div>
                                <span style="font-weight: 500;">Entertainment</span>
                            </div>
                            <span style="font-weight: 600; color: var(--text-primary);" id="tentertainment">GH${{ t_entertainment }}</span>
                        </div>
                        {% endif %}
                        
                        {% if t_business %}
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem; 
                                    background-color: var(--bg-secondary); border-radius: var(--radius-lg);">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; 
                                            background-color: var(--warning-color); display: flex; 
                                            align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-briefcase"></i>
                                </div>
                                <span style="font-weight: 500;">Business</span>
                            </div>
                            <span style="font-weight: 600; color: var(--text-primary);" id="tbusiness">GH${{ t_business }}</span>
                        </div>
                        {% endif %}
                        
                        {% if t_rent %}
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem; 
                                    background-color: var(--bg-secondary); border-radius: var(--radius-lg);">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; 
                                            background-color: var(--danger-color); display: flex; 
                                            align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-home"></i>
                                </div>
                                <span style="font-weight: 500;">Rent</span>
                            </div>
                            <span style="font-weight: 600; color: var(--text-primary);" id="trent">GH${{ t_rent }}</span>
                        </div>
                        {% endif %}
                        
                        {% if t_EMI %}
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem; 
                                    background-color: var(--bg-secondary); border-radius: var(--radius-lg);">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; 
                                            background-color: var(--gray-500); display: flex; 
                                            align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-credit-card"></i>
                                </div>
                                <span style="font-weight: 500;">EMI</span>
                            </div>
                            <span style="font-weight: 600; color: var(--text-primary);" id="temi">GH${{ t_EMI }}</span>
                        </div>
                        {% endif %}
                        
                        {% if t_other %}
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem; 
                                    background-color: var(--bg-secondary); border-radius: var(--radius-lg);">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; 
                                            background-color: var(--accent-color); display: flex; 
                                            align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-shopping-bag"></i>
                                </div>
                                <span style="font-weight: 500;">Other</span>
                            </div>
                            <span style="font-weight: 600; color: var(--text-primary);" id="tother">GH${{ t_other }}</span>
                        </div>
                        {% endif %}
                        
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem; 
                                    background-color: var(--primary-color); border-radius: var(--radius-lg); 
                                    color: white; margin-top: 0.5rem;">
                            <span style="font-weight: 600;">Total</span>
                            <span style="font-weight: 700;">GH${{ total }}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chart -->
            <div class="card" data-aos="fade-up" data-aos-delay="300">
                <div class="card-header">
                    <h3 class="card-title">Visual Breakdown</h3>
                    <p class="card-subtitle">Monthly spending by category</p>
                </div>
                <div class="card-body">
                    <canvas id="myChart" style="height: 250px;"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Monthly Trends -->
        <div class="card mt-5" data-aos="fade-up" data-aos-delay="400">
            <div class="card-header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 class="card-title">Monthly Trends</h3>
                        <p class="card-subtitle">Compare with previous months</p>
                    </div>
                    <select class="form-control form-select" style="width: auto;">
                        <option>Last 3 months</option>
                        <option>Last 6 months</option>
                        <option>Last year</option>
                    </select>
                </div>
            </div>
            <div class="card-body">
                <canvas id="trendChart" style="height: 250px;"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Category Chart
    {% if total and total > 0 %}
    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: [
                {% if t_food %}'Food',{% endif %}
                {% if t_entertainment %}'Entertainment',{% endif %}
                {% if t_business %}'Business',{% endif %}
                {% if t_rent %}'Rent',{% endif %}
                {% if t_EMI %}'EMI',{% endif %}
                {% if t_other %}'Other'{% endif %}
            ],
            datasets: [{
                data: [
                    {% if t_food %}{{ t_food }},{% endif %}
                    {% if t_entertainment %}{{ t_entertainment }},{% endif %}
                    {% if t_business %}{{ t_business }},{% endif %}
                    {% if t_rent %}{{ t_rent }},{% endif %}
                    {% if t_EMI %}{{ t_EMI }},{% endif %}
                    {% if t_other %}{{ t_other }}{% endif %}
                ],
                backgroundColor: [
                    'rgb(99, 102, 241)',
                    'rgb(16, 185, 129)',
                    'rgb(245, 158, 11)',
                    'rgb(239, 68, 68)',
                    'rgb(107, 114, 128)',
                    'rgb(245, 158, 11)'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        font: {
                            size: 12
                        }
                    }
                },
                title: {
                    display: true,
                    text: 'EXPENSE BREAKDOWN',
                    font: {
                        size: 14,
                        weight: 'bold'
                    }
                }
            }
        }
    });
    
    // Trend Chart
    const trendCtx = document.getElementById('trendChart').getContext('2d');
    new Chart(trendCtx, {
        type: 'bar',
        data: {
            labels: ['2 Months Ago', 'Last Month', 'This Month'],
            datasets: [{
                label: 'Monthly Expenses',
                data: [3200, 2800, {{ total }}],
                backgroundColor: [
                    'rgba(99, 102, 241, 0.7)',
                    'rgba(99, 102, 241, 0.8)',
                    'rgba(99, 102, 241, 1)'
                ],
                borderColor: [
                    'rgb(99, 102, 241)',
                    'rgb(99, 102, 241)',
                    'rgb(99, 102, 241)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
    {% endif %}
</script>
{% endblock %}
