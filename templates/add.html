{% extends "base.html" %}

{% block title %}Add Expense - MoneyTrack{% endblock %}

{% block page_title %}Add Expense{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb-item">
    <i class="fas fa-home"></i>
    <span>Dashboard</span>
</div>
<span class="breadcrumb-separator">/</span>
<div class="breadcrumb-item">
    <i class="fas fa-plus-circle"></i>
    <span>Add Expense</span>
</div>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3">
    <!-- Main Form -->
    <div class="lg:col-span-2">
        <div class="card" data-aos="fade-up">
            <div class="card-header">
                <h3 class="card-title">New Expense Entry</h3>
                <p class="card-subtitle">Track your spending to stay on budget</p>
            </div>
            <div class="card-body">
                <form action="/addexpense" method="POST" id="expenseForm">
                    <div class="grid grid-cols-1 md:grid-cols-2">
                        <div class="form-group">
                            <label for="date" class="form-label">
                                <i class="fas fa-calendar-alt"></i>
                                Date & Time
                            </label>
                            <input type="datetime-local" 
                                   id="date" 
                                   name="date" 
                                   class="form-control" 
                                   required>
                        </div>

                        <div class="form-group">
                            <label for="amount" class="form-label">
                                <i class="fas fa-dollar-sign"></i>
                                Amount (GH$)
                            </label>
                            <input type="number" 
                                   id="amount" 
                                   name="amount" 
                                   class="form-control" 
                                   min="0" 
                                   step="0.01" 
                                   placeholder="0.00" 
                                   required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="expensename" class="form-label">
                            <i class="fas fa-tag"></i>
                            Expense Description
                        </label>
                        <input type="text" 
                               id="expensename" 
                               name="expensename" 
                               class="form-control" 
                               placeholder="What did you spend on?" 
                               required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2">
                        <div class="form-group">
                            <label for="category" class="form-label">
                                <i class="fas fa-list"></i>
                                Category
                            </label>
                            <select id="category" name="category" class="form-control form-select" required>
                                <option value="" disabled selected>Select category</option>
                                <option value="food">ğŸ½ï¸ Food & Dining</option>
                                <option value="entertainment">ğŸ¬ Entertainment</option>
                                <option value="business">ğŸ’¼ Business</option>
                                <option value="rent">ğŸ  Rent & Housing</option>
                                <option value="EMI">ğŸ’³ EMI & Loans</option>
                                <option value="transport">ğŸš— Transportation</option>
                                <option value="healthcare">ğŸ¥ Healthcare</option>
                                <option value="education">ğŸ“š Education</option>
                                <option value="shopping">ğŸ›ï¸ Shopping</option>
                                <option value="other">ğŸ“¦ Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="paymode" class="form-label">
                                <i class="fas fa-credit-card"></i>
                                Payment Method
                            </label>
                            <select id="paymode" name="paymode" class="form-control form-select" required>
                                <option value="" disabled selected>Select payment method</option>
                                <option value="cash">ğŸ’µ Cash</option>
                                <option value="debitcard">ğŸ’³ Debit Card</option>
                                <option value="creditcard">ğŸ’ Credit Card</option>
                                <option value="epayment">ğŸ“± E-Payment</option>
                                <option value="onlinebanking">ğŸ¦ Online Banking</option>
                                <option value="mobilemoney">ğŸ“² Mobile Money</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="notes" class="form-label">
                            <i class="fas fa-sticky-note"></i>
                            Notes (Optional)
                        </label>
                        <textarea id="notes" 
                                  name="notes" 
                                  class="form-control" 
                                  rows="3" 
                                  placeholder="Add any additional notes about this expense..."></textarea>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-plus"></i>
                            Add Expense
                        </button>
                        <a href="/home" class="btn btn-secondary">
                            <i class="fas fa-times"></i>
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div>
        <!-- Quick Tips -->
        <div class="card mb-4" data-aos="fade-left" data-aos-delay="200">
            <div class="card-header">
                <h3 class="card-title">ğŸ’¡ Smart Tips</h3>
            </div>
            <div class="card-body">
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                        <div style="background-color: var(--success-color); color: white; 
                                    border-radius: 50%; width: 24px; height: 24px; 
                                    display: flex; align-items: center; justify-content: center; 
                                    font-size: 0.75rem; flex-shrink: 0;">
                            âœ“
                        </div>
                        <div>
                            <div style="font-weight: 500; margin-bottom: 0.25rem;">Track immediately</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                Record expenses as soon as they happen for better accuracy
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                        <div style="background-color: var(--primary-color); color: white; 
                                    border-radius: 50%; width: 24px; height: 24px; 
                                    display: flex; align-items: center; justify-content: center; 
                                    font-size: 0.75rem; flex-shrink: 0;">
                            ğŸ“Š
                        </div>
                        <div>
                            <div style="font-weight: 500; margin-bottom: 0.25rem;">Categorize correctly</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                Proper categorization helps with better spending insights
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                        <div style="background-color: var(--warning-color); color: white; 
                                    border-radius: 50%; width: 24px; height: 24px; 
                                    display: flex; align-items: center; justify-content: center; 
                                    font-size: 0.75rem; flex-shrink: 0;">
                            ğŸ“
                        </div>
                        <div>
                            <div style="font-weight: 500; margin-bottom: 0.25rem;">Add details</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                Include notes to remember what the expense was for
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Categories -->
        <div class="card" data-aos="fade-left" data-aos-delay="300">
            <div class="card-header">
                <h3 class="card-title">ğŸ“ˆ Recent Categories</h3>
            </div>
            <div class="card-body">
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 500;">ğŸ½ï¸ Food</span>
                        <span style="color: var(--text-secondary);">GH$245.50</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 500;">ğŸš— Transport</span>
                        <span style="color: var(--text-secondary);">GH$89.20</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 500;">ğŸ¬ Entertainment</span>
                        <span style="color: var(--text-secondary);">GH$156.75</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Set current date and time
    document.addEventListener('DOMContentLoaded', function() {
        const now = new Date();
        const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
            .toISOString()
            .slice(0, 16);
        document.getElementById('date').value = localDateTime;
    });

    // Form validation and enhancement
    const form = document.getElementById('expenseForm');
    const amountInput = document.getElementById('amount');
    const categorySelect = document.getElementById('category');
    const paymentSelect = document.getElementById('paymode');

    // Format amount input
    amountInput.addEventListener('input', function() {
        let value = this.value;
        if (value && !isNaN(value)) {
            this.style.borderColor = 'var(--success-color)';
        } else {
            this.style.borderColor = 'var(--gray-200)';
        }
    });

    // Category selection enhancement
    categorySelect.addEventListener('change', function() {
        this.style.borderColor = 'var(--success-color)';
    });

    // Payment method selection enhancement
    paymentSelect.addEventListener('change', function() {
        this.style.borderColor = 'var(--success-color)';
    });

    // Form submission
    form.addEventListener('submit', function(e) {
        const amount = parseFloat(amountInput.value);
        
        if (amount <= 0) {
            e.preventDefault();
            Toastify({
                text: "Please enter a valid amount greater than 0",
                duration: 3000,
                gravity: "top",
                position: "right",
                backgroundColor: "linear-gradient(135deg, #ef4444, #dc2626)",
                close: true
            }).showToast();
            return;
        }

        // Show loading state
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
        submitBtn.disabled = true;

        // Re-enable button after a delay (in case of errors)
        setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }, 5000);
    });

    // Auto-save to localStorage
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        // Load saved data
        const savedValue = localStorage.getItem(`expense_${input.name}`);
        if (savedValue && input.name !== 'date') {
            input.value = savedValue;
        }

        // Save on change
        input.addEventListener('change', function() {
            localStorage.setItem(`expense_${this.name}`, this.value);
        });
    });

    // Clear saved data on successful submission
    form.addEventListener('submit', function() {
        inputs.forEach(input => {
            localStorage.removeItem(`expense_${input.name}`);
        });
    });
</script>
{% endblock %}
